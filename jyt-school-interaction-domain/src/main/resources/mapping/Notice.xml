<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yjtoon.school.mapper.INoticeMapper">
	<resultMap id="BaseResultMap" type="com.yjtoon.school.domain.Notice">
		<id column="no_id" property="noId" jdbcType="BIGINT" />
		<result column="no_title" property="noTitle" jdbcType="VARCHAR" />
		<result column="no_type" property="noType" jdbcType="TINYINT" />
		<result column="no_content" property="noContent" jdbcType="VARCHAR" />
		<result column="no_subject" property="noSubject" jdbcType="VARCHAR" />
		<result column="no_exam_id" property="noExamId" jdbcType="BIGINT" />
		<result column="no_publisher_id" property="noPublisherId" jdbcType="BIGINT" />
		<result column="no_receipt" property="noReceipt" jdbcType="TINYINT" />
		<result column="no_picture" property="noPicture" jdbcType="TINYINT" />
		<result column="no_ranking" property="noRanking" jdbcType="TINYINT" />
		<result column="no_receipt_time" property="noReceiptTime" jdbcType="TIMESTAMP" />
		<result column="no_is_delete" property="noIsDelete" jdbcType="CHAR" />
		<result column="remark" property="remark" jdbcType="VARCHAR" />
		<result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
		<result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
	</resultMap>

	<resultMap id="BaseResultMapExt" type="com.yjtoon.school.vo.NoticeExtVO" extends="BaseResultMap">
		<result column="nr_consult" property="nrConsult" jdbcType="TINYINT" />
		<result column="nr_receipt" property="nrReceipt" jdbcType="TINYINT" />
	</resultMap>


	<sql id="baseColumns">
		no_id
		,no_title
		,no_type
		,no_content
		,no_subject
		,no_exam_id
		,no_publisher_id
		,no_receipt
		,no_picture
		,no_ranking
		,no_receipt_time
		,no_is_delete
		,remark
		,create_time
		,update_time
	</sql>

	<sql id="whereSql">
		<if test="noId != null">
			and no_id=#{noId}
		</if>
		<if test="noTitle != null and noTitle!='' ">
			and no_title=#{noTitle}
		</if>
		<if test="noType != null">
			and no_type=#{noType}
		</if>
		<if test="noContent != null and noContent!='' ">
			and no_content=#{noContent}
		</if>
		<if test="noSubject != null and noSubject!='' ">
			and no_subject=#{noSubject}
		</if>
		<if test="noExamId != null and noExamId!='' ">
			and no_exam_id=#{noExamId}
		</if>
		<if test="noPublisherId != null and noPublisherId!='' ">
			and no_publisher_id=#{noPublisherId}
		</if>
		<if test="noReceipt != null">
			and no_receipt=#{noReceipt}
		</if>
		<if test="noPicture != null">
			and no_picture=#{noPicture}
		</if>
		<if test="noRanking != null">
			and no_ranking=#{noRanking}
		</if>
		<if test="noReceiptTime != null">
			and no_receipt_time=#{noReceiptTime}
		</if>
		<if test="noIsDelete != null and noIsDelete!='' ">
			and no_is_delete=#{noIsDelete}
		</if>
		<if test="remark != null and remark!='' ">
			and remark=#{remark}
		</if>
		<if test="createTime != null">
			and create_time=#{createTime}
		</if>
		<if test="updateTime != null">
			and update_time=#{updateTime}
		</if>
	</sql>

	<select id="getById" resultMap="BaseResultMap">
		select
		<include refid="baseColumns" />
		from notice where no_id =#{noId}
	</select>

	<select id="getByIds" resultMap="BaseResultMap">
		select
		<include refid="baseColumns" />
		from notice where no_id in
		<foreach collection="array" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
	</select>

	<select id="get" resultMap="BaseResultMap" parameterType="com.yjtoon.school.domain.Notice">
		select
		<include refid="baseColumns" />
		from notice where 1=1
		<include refid="whereSql" />
		limit 1
	</select>

	<select id="findAllList" resultMap="BaseResultMap">
		select
		<include refid="baseColumns" />
		from notice
	</select>

	<select id="findList" parameterType="com.yjtoon.school.domain.Notice"
		resultMap="BaseResultMap">
		select
		<include refid="baseColumns" />
		from notice where 1=1
		<include refid="whereSql" />
		<if test="orderBy != null and orderBy!='' ">
			order by ${orderBy}
		</if>
	</select>


	<select id="getCount" parameterType="com.yjtoon.school.domain.Notice"
		resultType="java.lang.Integer">
		select count(1) from notice where 1=1
		<include refid="whereSql" />
	</select>

	<select id="findEntityWrapper" parameterType="com.yjtoon.framework.sqlplus.EntityWrapper"
		resultMap="BaseResultMap">
		select
		<include refid="baseColumns" />
		from notice where 1=1 ${ew.getSqlSegment()}
	</select>

	<insert id="insert" useGeneratedKeys="true" keyProperty="noId" parameterType="com.yjtoon.school.domain.Notice">
		insert into notice
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="noId != null">
				no_id,
			</if>
			<if test="noTitle != null and noTitle!='' ">
				no_title,
			</if>
			<if test="noType != null">
				no_type,
			</if>
			<if test="noContent != null and noContent!='' ">
				no_content,
			</if>
			<if test="noSubject != null and noSubject!='' ">
				no_subject,
			</if>
			<if test="noExamId != null and noExamId!='' ">
				no_exam_id,
		    </if>
			<if test="noPublisherId != null and noPublisherId!='' ">
				no_publisher_id,
			</if>
			<if test="noReceipt != null">
				no_receipt,
			</if>
			<if test="noPicture != null">
				no_picture,
			</if>
			<if test="noRanking != null">
				no_ranking,
			</if>
			<if test="noReceiptTime != null">
				no_receipt_time,
			</if>
			<if test="noIsDelete != null and noIsDelete!='' ">
				no_is_delete,
			</if>
			<if test="remark != null and remark!='' ">
				remark,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="noId != null">
				#{noId},
			</if>
			<if test="noTitle != null and noTitle!='' ">
				#{noTitle},
			</if>
			<if test="noType != null">
				#{noType},
			</if>
			<if test="noContent != null and noContent!='' ">
				#{noContent},
			</if>
			<if test="noSubject != null and noSubject!='' ">
				#{noSubject},
			</if>
			<if test="noExamId != null and noExamId!='' ">
				#{noExamId},
		    </if>
			<if test="noPublisherId != null and noPublisherId!='' ">
				#{noPublisherId},
			</if>
			<if test="noReceipt != null">
				#{noReceipt},
			</if>
			<if test="noPicture != null">
				#{noPicture},
			</if>
			<if test="noRanking != null">
				#{noRanking},
			</if>
			<if test="noReceiptTime != null">
				#{noReceiptTime},
			</if>
			<if test="noIsDelete != null and noIsDelete!='' ">
				#{noIsDelete},
			</if>
			<if test="remark != null and remark!='' ">
				#{remark},
			</if>
			<if test="createTime != null">
				#{createTime},
			</if>
			<if test="updateTime != null">
				#{updateTime},
			</if>
		</trim>
	</insert>

	<update id="updateById" parameterType="com.yjtoon.school.domain.Notice">
		update notice set
		<trim suffixOverrides=",">
			<if test="noTitle != null and noTitle!='' ">
				no_title=#{noTitle},
			</if>
			<if test="noType != null">
				no_type=#{noType},
			</if>
			<if test="noContent != null and noContent!='' ">
				no_content=#{noContent},
			</if>
			<if test="noSubject != null and noSubject!='' ">
				no_subject=#{noSubject},
			</if>
			<if test="noExamId != null and noExamId!='' ">
				no_exam_id=#{noExamId},
		    </if>
			<if test="noPublisherId != null and noPublisherId!='' ">
				no_publisher_id=#{noPublisherId},
			</if>
			<if test="noReceipt != null">
				no_receipt=#{noReceipt},
			</if>
			<if test="noPicture != null">
				no_picture=#{noPicture},
			</if>
			<if test="noRanking != null">
				no_ranking=#{noRanking},
			</if>
			<if test="noReceiptTime != null">
				no_receipt_time=#{noReceiptTime},
			</if>
			<if test="noIsDelete != null and noIsDelete!='' ">
				no_is_delete=#{noIsDelete},
			</if>
			<if test="remark != null and remark!='' ">
				remark=#{remark},
			</if>
			<if test="createTime != null">
				create_time=#{createTime},
			</if>
			<if test="updateTime != null">
				update_time=#{updateTime},
			</if>
		</trim>
		where no_id =#{noId}
	</update>

	<update id="updateByIds">
		update notice set
		<trim suffixOverrides=",">
			<if test="entity.noTitle != null and entity.noTitle != '' ">
				no_title= #{entity.noTitle},
			</if>
			<if test="entity.noType != null">
				no_type= #{entity.noType},
			</if>
			<if test="entity.noContent != null and entity.noContent != '' ">
				no_content= #{entity.noContent},
			</if>
			<if test="entity.noSubject != null and entity.noSubject != '' ">
				no_subject= #{entity.noSubject},
			</if>
			<if test="entity.noExamId != null and entity.noExamId!='' ">
				no_exam_id=#{entity.noExamId},
		    </if>
			<if test="entity.noPublisherId != null and entity.noPublisherId != '' ">
				no_publisher_id= #{entity.noPublisherId},
			</if>
			<if test="entity.noReceipt != null">
				no_receipt= #{entity.noReceipt},
			</if>
			<if test="entity.noPicture != null">
				no_picture= #{entity.noPicture},
			</if>
			<if test="entity.noRanking != null">
				no_ranking= #{entity.noRanking},
			</if>
			<if test="entity.noReceiptTime != null">
				no_receipt_time= #{entity.noReceiptTime},
			</if>
			<if test="entity.noIsDelete != null and entity.noIsDelete != '' ">
				no_is_delete= #{entity.noIsDelete},
			</if>
			<if test="entity.remark != null and entity.remark != '' ">
				remark= #{entity.remark},
			</if>
			<if test="entity.createTime != null">
				create_time= #{entity.createTime},
			</if>
			<if test="entity.updateTime != null">
				update_time= #{entity.updateTime},
			</if>
		</trim>
		where no_id in
		<foreach collection="ids" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
	</update>


	<delete id="deleteById">
		delete from notice where no_id =#{noId}
	</delete>

	<delete id="deleteByIds">
		delete from notice where no_id in
		<foreach collection="array" item="item" index="index" open="("
			close=")" separator=",">
			#{item}
		</foreach>
	</delete>

	<delete id="delete" parameterType="com.yjtoon.school.domain.Notice">
		delete from notice where 1=1
		<include refid="whereSql" />
	</delete>

	<select id="getNoticeByFilterForPublisher" resultMap="BaseResultMapExt">
		select
		<include refid="baseColumns" />
		from notice a
		where a.no_publisher_id=#{currentUserId}
		<if test="noTypeList != null and noTypeList.size>0">
			and 
			<foreach collection="noTypeList" item="item" index="index" open="(" close=")" separator="or">
				a.no_type = #{item}
			</foreach>
		</if>
		<if test="classIdList != null and classIdList.size>0">
			and exists(select 1 from notice_range b where a.no_id=b.no_id and
			<foreach collection="classIdList" item="item" index="index" open="(" close=")" separator="or">
				b.ci_id = #{item}
			</foreach>
			)
		</if>
		order by a.create_time desc
	</select>

	<select id="getNoticeByFilterForReceiver" resultMap="BaseResultMapExt">
		select a.*,b.nr_consult,nr_receipt from notice a,notice_range b
		where a.no_id=b.no_id
		and b.nr_user_id=#{currentUserId}
		<if test="userType != null">
			and b.nr_type=#{userType}
		</if>
		<if test="noTypeList != null and noTypeList.size>0">
			and 
			<foreach collection="noTypeList" item="item" index="index" open="(" close=")" separator="or">
				a.no_type = #{item}
			</foreach>
		</if>
		order by a.create_time desc
	</select>

	<!-- <select id="getNoticeForReceiver" resultMap="BaseResultMap">
		select
		<include refid="baseColumns" />
		from notice a
		where exists(select 1 from notice_range b where
		a.no_id=b.no_id and b.nr_user_id=#{currentUserId})
		order by a.create_time desc
	</select> -->

</mapper>